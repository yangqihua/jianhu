<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>荐乎</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    <link rel="stylesheet" href="http://res.jian-hu.cn/static/jquery-weui/dist/lib/weui.css">
    <link rel="stylesheet" href="http://res.jian-hu.cn/static/jquery-weui/dist/css/jquery-weui.css">
    <link rel="stylesheet" href="http://res.jian-hu.cn/static/dist/css/app-index.css">
</head>

<body>
<div class="weui_tab">
    <div class="weui_navbar jian-title">
        <img src="http://res.jian-hu.cn/static/img/jianhu@2x.png" height="30px" width="52px" style="margin: 7px auto">
    </div>
    <!--以 weui_tab_bd 作为外部容器，下拉刷新、滚动加载控件必须在这个容器的之中-->
    <div class="weui_tab_bd" style="margin-top: -42px;padding-top: 87px">
        <!--内容区-->
        <div id="content">
            <div class="jian_list_items">
                <!-- item-start -->

                <!-- item-end -->
            </div>
        </div>
        <!-- content end -->
        <!--滚动加载控件-->
        <div class="weui-infinite-scroll">
            <div class="infinite-preloader"></div>
            正在加载...
        </div>
    </div>

    <div class="jian-fabu-btn">
        <a href="/job/fabu_job"><img src="http://res.jian-hu.cn/static/img/btn_fabu@2x.png" width="80px" height="80px"></a>
    </div>

    <div class="weui_tabbar">
        <a href="javascript:;" class="weui_tabbar_item" style="padding-top: 0">
            <div class="jian-tabbar-item">
                <img id="1" class="tab" src="http://res.jian-hu.cn/static/img/btn_pre_faxian@2x.png" width="100%"
                     height="100%">
            </div>
        </a>
        <a href="javascript:;" class="weui_tabbar_item" style="padding-top: 0">
            <div class="jian-tabbar-item">
                <img id="2" class="tab" src="http://res.jian-hu.cn/static/img/btn_nor_mesaage@2x.png" width="100%"
                     height="100%">
            </div>
        </a>
        <a href="javascript:;" class="weui_tabbar_item" style="padding-top: 0">
            <div class="jian-tabbar-item">
                <img id="3" class="tab" src="http://res.jian-hu.cn/static/img/btn_nor_wd@2x.png" width="100%"
                     height="100%">
            </div>
        </a>
    </div>
</div>
<script src="http://res.jian-hu.cn/static/jquery-weui/dist/lib/jquery-2.1.4.js"></script>
<script src="http://res.jian-hu.cn/static/jquery-weui/dist/js/jquery-weui.js"></script>
<script src="http://res.jian-hu.cn/static/dist/js/app-index.js"></script>
<script type="text/javascript">
    var own_job = {{ own_job|safe }};
    var job_list = {{ job_list|safe }};
    var job = own_job;
    var jian_item = '<div class="jian-item-space"></div><div class="jian-item-title" id="'+job.job_uuid+'"><div><font class="jian-item-title-font">' + job.job_title + '</font></div><div class="weui-row weui-no-gutter jian-item-content"><div class="weui-col-33"><img class="jian-item-content-img"src="http://res.jian-hu.cn/static/img/icn_place@2x.png"><font class="jian-item-content-fontyahei">' + job.city + '</font></div><div class="weui-col-23" style="padding-left: 7px;"><img src="http://res.jian-hu.cn/static/img/icn_time@2x.png" class="jian-item-content-img"><font class="jian-item-content-fontyahei">' + job.work_experience + '</font> </div><div class="weui-col-22" style="padding-left: 12px;"><img src="http://res.jian-hu.cn/static/img/icn_xueli@2x.png" class="jian-item-content-img"><font class="jian-item-content-fontyahei">' + job.education + '</font></div><div class="weui-col-22"><div class="jian-item-content-fontxinzi" style="float: right">￥' + job.salary + '</div></div></div><div class="weui-row weui-no-gutter jian-item-me"><div class="weui-col-30"><img src="' + job.portrait + '" class="jian-item-me-img"><font class="jian-item-me-fontname">我的发布</font></div><div class="weui-col-40" style="text-align: center;"><font class="jian-item-me-fontcompany">' + job.company_name + '</font></div><div class="weui-col-30" style="text-align: right"><font class="jian-item-me-fontcompany">' + job.create_time + '发布</font></div></div></div>';
    $(".jian_list_items").append(jian_item);
    console.log(job_list.length);
    for (var i = 0; i < job_list.length; i++) {
        job = job_list[i];
        jian_item = '<div class="jian-item-space"></div><div class="jian-item-title" id="'+job.job_uuid+'"><div><font class="jian-item-title-font">' + job.job_title + '</font></div><div class="weui-row weui-no-gutter jian-item-content"><div class="weui-col-33"><img class="jian-item-content-img"src="http://res.jian-hu.cn/static/img/icn_place@2x.png"><font class="jian-item-content-fontyahei">' + job.city + '</font></div><div class="weui-col-23" style="padding-left: 7px;"><img src="http://res.jian-hu.cn/static/img/icn_time@2x.png" class="jian-item-content-img"><font class="jian-item-content-fontyahei">' + job.work_experience + '</font> </div><div class="weui-col-22" style="padding-left: 12px;"><img src="http://res.jian-hu.cn/static/img/icn_xueli@2x.png" class="jian-item-content-img"><font class="jian-item-content-fontyahei">' + job.education + '</font></div><div class="weui-col-22"><div class="jian-item-content-fontxinzi" style="float: right">￥' + job.salary + '</div></div></div><div class="weui-row weui-no-gutter jian-item-me"><div class="weui-col-30"><img src="' + job.portrait + '" class="jian-item-me-img"><font class="jian-item-me-fontname">'+job.username+'</font></div><div class="weui-col-40" style="text-align: center;"><font class="jian-item-me-fontcompany">' + job.company_name + '</font></div><div class="weui-col-30" style="text-align: right"><font class="jian-item-me-fontcompany">' + job.create_time + '发布</font></div></div></div>';
        $(".jian_list_items").append(jian_item);
    }

    {#    item_count = $('.jian_list_items').children().length / 2;#}
    var from = job_list.length;
    if (from >= 10) {        //第一页数据大于10才启用滚到加载组件,一页数据为10个
        var loading = false;  //状态标记
        $('.weui_tab_bd').infinite();
        $('.weui_tab_bd').infinite().on("infinite", function () {
            console.log("okk");
            jian_item = '';
            if (loading) return;
            loading = true;
            $.get("/user/fabu_list", {"from": from},
                    function (data) {
                        job_list = data;
                        from = from + data.length;
                        if (data.length < 10) {
                            $('.weui-infinite-scroll').css('display', 'none');//刚开始隐藏
                            $('.weui_tab_bd').destroyInfinite(); //销毁该组件
                        }
                        for (var i = 0; i < job_list.length; i++) {
                            var job = job_list[i];
                            jian_item = '<div class="jian-item-space"></div><div class="jian-item-title" id="'+job.job_uuid+'"><div><font class="jian-item-title-font">' + job.job_title + '</font></div><div class="weui-row weui-no-gutter jian-item-content"><div class="weui-col-33"><img class="jian-item-content-img"src="http://res.jian-hu.cn/static/img/icn_place@2x.png"><font class="jian-item-content-fontyahei">' + job.city + '</font></div><div class="weui-col-23" style="padding-left: 7px;"><img src="http://res.jian-hu.cn/static/img/icn_time@2x.png" class="jian-item-content-img"><font class="jian-item-content-fontyahei">' + job.work_experience + '</font> </div><div class="weui-col-22" style="padding-left: 12px;"><img src="http://res.jian-hu.cn/static/img/icn_xueli@2x.png" class="jian-item-content-img"><font class="jian-item-content-fontyahei">' + job.education + '</font></div><div class="weui-col-22"><div class="jian-item-content-fontxinzi" style="float: right">￥' + job.salary + '</div></div></div><div class="weui-row weui-no-gutter jian-item-me"><div class="weui-col-30"><img src="' + job.portrait + '" class="jian-item-me-img"><font class="jian-item-me-fontname">'+job.username+'</font></div><div class="weui-col-40" style="text-align: center;"><font class="jian-item-me-fontcompany">' + job.company_name + '</font></div><div class="weui-col-30" style="text-align: right"><font class="jian-item-me-fontcompany">' + job.create_time + '发布</font></div></div></div>';
                            $(".jian_list_items").append(jian_item);
                        }
                        loading = false;
                    });
        });
    } else {
        $('.weui-infinite-scroll').css('display', 'none');//刚开始隐藏
    }

    $('.jian-item-title').on('click', function (event) {
        var job_uuid = $(this).attr('id');
        location.href = "/job/get_job?job_uuid="+job_uuid;
    });
</script>

</body>
</html>
